#!/bin/bash
# Copyright (C) 2013 Jonas Friedmann under the "Do What The Fuck You Want To Public" License 
# (see ./LICENSE for more informations)

#####
# Settings / variables
#####

hostname=${1}
i=1

#####
# DO NOT EDIT BELOW
#####

# Usage function
usage(){
	echo "Usage: $0 <hostname>"
	exit 1
}

# Check for IP function
isip() {
   if [[ $1 =~ ^[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}$ ]]
   then
      ret=0
   else
      ret=1
   fi
   return $ret
}

# Check if argument is given
if [ -z "${hostname}" ]
then
	echo "Error: no argument given!"
	usage
fi

# Store the DNS results
servers=$(dig +short ${hostname})

echo "${hostname} returned the following DNS records:"

# For each resulted server 
for server in ${servers}
do
	if isip ${server};
	then 
	    echo "$i. returned IP: ${server}"

	    # Lookup PTR
	    ptr=$(dig +short -x ${server})

	    # Check if PTR is not empty
	    if [ -z "${ptr}" ]
	    then
	    	echo "   Error: No PTR set for ${server}"
	    else
	    	echo "   correspondingÂ PTR: ${ptr}"
	    fi
	else 
	    echo "$i. returned hostname (CNAME): ${server} -> skip"
	fi

	# Count
	i=$((i+1))
done